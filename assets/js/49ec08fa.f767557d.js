"use strict";(self.webpackChunkroys_blog=self.webpackChunkroys_blog||[]).push([[6111],{3905:(r,e,n)=>{n.d(e,{Zo:()=>u,kt:()=>m});var t=n(7294);function o(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function a(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.push.apply(n,t)}return n}function l(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){o(r,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))}))}return r}function s(r,e){if(null==r)return{};var n,t,o=function(r,e){if(null==r)return{};var n,t,o={},a=Object.keys(r);for(t=0;t<a.length;t++)n=a[t],e.indexOf(n)>=0||(o[n]=r[n]);return o}(r,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(t=0;t<a.length;t++)n=a[t],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(r,n)&&(o[n]=r[n])}return o}var i=t.createContext({}),c=function(r){var e=t.useContext(i),n=e;return r&&(n="function"==typeof r?r(e):l(l({},e),r)),n},u=function(r){var e=c(r.components);return t.createElement(i.Provider,{value:e},r.children)},d={inlineCode:"code",wrapper:function(r){var e=r.children;return t.createElement(t.Fragment,{},e)}},p=t.forwardRef((function(r,e){var n=r.components,o=r.mdxType,a=r.originalType,i=r.parentName,u=s(r,["components","mdxType","originalType","parentName"]),p=c(n),m=o,g=p["".concat(i,".").concat(m)]||p[m]||d[m]||a;return n?t.createElement(g,l(l({ref:e},u),{},{components:n})):t.createElement(g,l({ref:e},u))}));function m(r,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof r||o){var a=n.length,l=new Array(a);l[0]=p;var s={};for(var i in e)hasOwnProperty.call(e,i)&&(s[i]=e[i]);s.originalType=r,s.mdxType="string"==typeof r?r:o,l[1]=s;for(var c=2;c<a;c++)l[c]=n[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9766:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var t=n(7462),o=(n(7294),n(3905));const a={id:"solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"},l=void 0,s={unversionedId:"solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",id:"solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",description:"\u5728\u524d\u9762\u7684\u6307\u4ee4\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8fd4\u56de ProgramResult \u7c7b\u578b\uff0c\u5176\u5b9a\u4e49\u4e3a\uff1a",source:"@site/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49.md",sourceDirName:"solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1",slug:"/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",draft:!1,editUrl:"https://github.com/iRoySwift/RoysBlog/tree/master/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49.md",tags:[],version:"current",frontMatter:{id:"solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"},sidebar:"docs",previous:{title:"3\u3001Solana\u5408\u7ea6\u5904\u7406\u903b\u8f91",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-processing-logic"},next:{title:"5\u3001\u8bfe\u540e\u7ec3\u4e60",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-exersize-5"}},i={},c=[{value:"1\u3001\u7cfb\u7edf\u9519\u8bef",id:"1\u7cfb\u7edf\u9519\u8bef",level:2},{value:"2\u3001\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",id:"2\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",level:2}],u={toc:c};function d(r){let{components:e,...n}=r;return(0,o.kt)("wrapper",(0,t.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5728\u524d\u9762\u7684\u6307\u4ee4\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8fd4\u56de ProgramResult \u7c7b\u578b\uff0c\u5176\u5b9a\u4e49\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"use {\n    std::{\n        result::Result as ResultGeneric,\n    },\n};\n\npub type ProgramResult = ResultGeneric<(), ProgramError>;\n")),(0,o.kt)("p",null,"\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4f7f\u7528\u4e86 ProgramError \u4f5c\u4e3a Err \u90e8\u5206\u7684 Result \u7c7b\u578b\u679a\u4e3e\u3002"),(0,o.kt)("h2",{id:"1\u7cfb\u7edf\u9519\u8bef"},"1\u3001\u7cfb\u7edf\u9519\u8bef"),(0,o.kt)("p",null,"\u4e0a\u9762\u63d0\u5230\u7684 ProgramError \u7684\u5b9a\u4e49\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'/// Reasons the program may fail\n#[derive(Clone, Debug, Deserialize, Eq, Error, PartialEq, Serialize)]\npub enum ProgramError {\n    /// Allows on-chain programs to implement program-specific error types and see them returned\n    /// by the Solana runtime. A program-specific error may be any type that is represented as\n    /// or serialized to a u32 integer.\n    #[error("Custom program error: {0:#x}")]\n    Custom(u32),\n    #[error("The arguments provided to a program instruction were invalid")]\n    InvalidArgument,\n    #[error("An instruction\'s data contents was invalid")]\n    InvalidInstructionData,\n    #[error("An account\'s data contents was invalid")]\n    InvalidAccountData,\n    #[error("An account\'s data was too small")]\n    AccountDataTooSmall,\n    #[error("An account\'s balance was too small to complete the instruction")]\n    InsufficientFunds,\n    #[error("The account did not have the expected program id")]\n    IncorrectProgramId,\n    #[error("A signature was required but not found")]\n    MissingRequiredSignature,\n    #[error("An initialize instruction was sent to an account that has already been initialized")]\n    AccountAlreadyInitialized,\n    #[error("An attempt to operate on an account that hasn\'t been initialized")]\n    UninitializedAccount,\n    #[error("The instruction expected additional account keys")]\n    NotEnoughAccountKeys,\n    #[error("Failed to borrow a reference to account data, already borrowed")]\n    AccountBorrowFailed,\n    #[error("Length of the seed is too long for address generation")]\n    MaxSeedLengthExceeded,\n    #[error("Provided seeds do not result in a valid address")]\n    InvalidSeeds,\n    #[error("IO Error: {0}")]\n    BorshIoError(String),\n    #[error("An account does not have enough lamports to be rent-exempt")]\n    AccountNotRentExempt,\n    #[error("Unsupported sysvar")]\n    UnsupportedSysvar,\n    #[error("Provided owner is not allowed")]\n    IllegalOwner,\n    #[error("Accounts data allocations exceeded the maximum allowed per transaction")]\n    MaxAccountsDataAllocationsExceeded,\n    #[error("Account data reallocation was invalid")]\n    InvalidRealloc,\n    #[error("Instruction trace length exceeded the maximum allowed per transaction")]\n    MaxInstructionTraceLengthExceeded,\n    #[error("Builtin programs must consume compute units")]\n    BuiltinProgramsMustConsumeComputeUnits,\n}\n')),(0,o.kt)("p",null,"\u56e0\u6b64\u6211\u4eec\u7684 process \u51fd\u6570\u91cc\u9762\u5fc5\u987b\u8981\u8fd4\u56de\u8fd9\u91cc\u7684\u4e00\u4e2a\u503c\u679a\u4e3e\u503c\u3002"),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u9519\u8bef\u679a\u4e3e\uff0c\u57fa\u672c\u610f\u4e49\u8fd8\u662f\u6bd4\u8f83\u660e\u786e\u7684\u3002\u6bd4\u5982\u53c2\u6570\u4e0d\u5bf9\uff0cGas \u4e0d\u591f\u3002\u76f8\u5f53\u4e8e\u7cfb\u7edf\u5df2\u7ecf\u628a\u9519\u8bef\u8fdb\u884c\u4e86\u5206\u7c7b\u3002"),(0,o.kt)("p",null,"\u4f46\u662f\u6211\u4eec\u5408\u7ea6\u4e2d\u7684\u9519\u8bef\u5176\u5b9e\u662f\u6bcf\u4e2a\u903b\u8f91\u4e0d\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u8981\u5982\u4f55\u53bb\u5b9a\u4e49\u4ed6\u5462\uff1f"),(0,o.kt)("p",null,"\u8fd9\u91cc\u4e0a\u9762\u7684\u5206\u7c7b\u4e2d\u6709\u4e00\u7c7b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"Custom(u32)\n")),(0,o.kt)("p",null,"\u8fd9\u4e2a\u5c31\u662f\u4e13\u95e8\u7ed9\u5e94\u7528\u5408\u7ea6\u5b9a\u4e49\u5176\u9519\u8bef\u7528\u7684\uff0c\u6bcf\u4e2a\u9519\u8bef\u7528\u4e00\u4e2a u32 \u6765\u8868\u793a"),(0,o.kt)("h2",{id:"2\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"},"2\u3001\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"),(0,o.kt)("p",null,"\u65e2\u7136\u662f\u7528 u32 \u7c7b\u533a\u522b\u5408\u7ea6\u9519\u8bef\uff0c\u81ea\u7136\u6211\u4eec\u60f3\u5230\u4e86 Rust \u91cc\u9762\u7684 enum \u6765\u5b9a\u4e49\u9519\u8bef\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'#[derive(Clone, Debug, Eq, Error, FromPrimitive, PartialEq)]\npub enum HelloWorldError {\n    #[error("Not owned by HelloWolrd Program")]\n    NotOwnedByHelloWrold,\n}\n')),(0,o.kt)("p",null,"\u4f46\u662f\u8fd9\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u679a\u4e3e\uff0c\u8981\u5982\u4f55\u8ba9\u4ed6\u53d8\u6210\u4e0a\u9762\u7684 Custom(u32) \u5462\uff1f\u56e0\u6b64\u9700\u8981\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"impl From<HelloWorldError> for ProgramError {\n    fn from(e: HelloWorldError) -> Self {\n        ProgramError::Custom(e as u32)\n    }\n}\n")),(0,o.kt)("p",null,"\u76f4\u63a5\u5c06\u679a\u4e3e\u7684\u503c\uff0c\u8f6c\u6362\u6210\u4e86 Custom \u91cc\u9762\u7684\u9519\u8bef\u7801\u3002"),(0,o.kt)("p",null,"\u9519\u8bef\u7801\u6709\u4e86\uff0c\u4f46\u662f\u9519\u8bef\u7801\u5bf9\u5e94\u7684\u610f\u4e49\u662f\u4ec0\u4e48\u5462\uff1f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'impl PrintProgramError for HelloWorldError {\n    fn print<E>(&self)\n    where\n        E: \'static + std::error::Error + DecodeError<E> + PrintProgramError + FromPrimitive,\n    {\n        match self {\n            HelloWorldError::NotOwnedByHelloWrold => msg!("Error: Greeted account does not have the correct program id!"),\n        }\n    }\n}\n')),(0,o.kt)("p",null,"\u8fd9\u91cc\u901a\u8fc7 PrintProgramError trate \u7684\u5b9e\u73b0\uff0c\u6765\u5b9a\u4e49\u5176\u9519\u8bef\u6d88\u606f\u3002"),(0,o.kt)("p",null,"\u8fd9\u6837\u5728\u51fa\u9519\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u76f8\u5e94\u9519\u8bef\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'if greeting_account.owner != program_id {\n    msg!("Greeted account does not have the correct program id");\n    return Err(HelloWorldError::NotOwnedByHelloWrold.into());\n}\n')),(0,o.kt)("p",null,"\u901a\u8fc7 into \u76f4\u63a5\u8f6c\u6362\u3002"))}d.isMDXComponent=!0}}]);