"use strict";(self.webpackChunkroys_blog=self.webpackChunkroys_blog||[]).push([[6111],{7447:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var o=e(1527),a=e(7279);const t={id:"solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"},s=void 0,l={id:"solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",description:"\u5728\u524d\u9762\u7684\u6307\u4ee4\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8fd4\u56de ProgramResult \u7c7b\u578b\uff0c\u5176\u5b9a\u4e49\u4e3a\uff1a",source:"@site/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49.md",sourceDirName:"solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1",slug:"/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-error",draft:!1,unlisted:!1,editUrl:"https://github.com/iRoySwift/RoysBlog/tree/master/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49.md",tags:[],version:"current",frontMatter:{id:"solana-Contract-error",title:"4\u3001Solana\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"},sidebar:"docs",previous:{title:"3\u3001Solana\u5408\u7ea6\u5904\u7406\u903b\u8f91",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-processing-logic"},next:{title:"5\u3001\u8bfe\u540e\u7ec3\u4e60",permalink:"/docs/solana/solana-bootcamp/5\u3001Solana\u5408\u7ea6\u5f00\u53d1Part1/solana-Contract-exersize-5"}},i={},c=[{value:"1\u3001\u7cfb\u7edf\u9519\u8bef",id:"1\u7cfb\u7edf\u9519\u8bef",level:2},{value:"2\u3001\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",id:"2\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",level:2}];function d(r){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"\u5728\u524d\u9762\u7684\u6307\u4ee4\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8fd4\u56de ProgramResult \u7c7b\u578b\uff0c\u5176\u5b9a\u4e49\u4e3a\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:"use {\n    std::{\n        result::Result as ResultGeneric,\n    },\n};\n\npub type ProgramResult = ResultGeneric<(), ProgramError>;\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4f7f\u7528\u4e86 ProgramError \u4f5c\u4e3a Err \u90e8\u5206\u7684 Result \u7c7b\u578b\u679a\u4e3e\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"1\u7cfb\u7edf\u9519\u8bef",children:"1\u3001\u7cfb\u7edf\u9519\u8bef"}),"\n",(0,o.jsx)(n.p,{children:"\u4e0a\u9762\u63d0\u5230\u7684 ProgramError \u7684\u5b9a\u4e49\u4e3a\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'/// Reasons the program may fail\n#[derive(Clone, Debug, Deserialize, Eq, Error, PartialEq, Serialize)]\npub enum ProgramError {\n    /// Allows on-chain programs to implement program-specific error types and see them returned\n    /// by the Solana runtime. A program-specific error may be any type that is represented as\n    /// or serialized to a u32 integer.\n    #[error("Custom program error: {0:#x}")]\n    Custom(u32),\n    #[error("The arguments provided to a program instruction were invalid")]\n    InvalidArgument,\n    #[error("An instruction\'s data contents was invalid")]\n    InvalidInstructionData,\n    #[error("An account\'s data contents was invalid")]\n    InvalidAccountData,\n    #[error("An account\'s data was too small")]\n    AccountDataTooSmall,\n    #[error("An account\'s balance was too small to complete the instruction")]\n    InsufficientFunds,\n    #[error("The account did not have the expected program id")]\n    IncorrectProgramId,\n    #[error("A signature was required but not found")]\n    MissingRequiredSignature,\n    #[error("An initialize instruction was sent to an account that has already been initialized")]\n    AccountAlreadyInitialized,\n    #[error("An attempt to operate on an account that hasn\'t been initialized")]\n    UninitializedAccount,\n    #[error("The instruction expected additional account keys")]\n    NotEnoughAccountKeys,\n    #[error("Failed to borrow a reference to account data, already borrowed")]\n    AccountBorrowFailed,\n    #[error("Length of the seed is too long for address generation")]\n    MaxSeedLengthExceeded,\n    #[error("Provided seeds do not result in a valid address")]\n    InvalidSeeds,\n    #[error("IO Error: {0}")]\n    BorshIoError(String),\n    #[error("An account does not have enough lamports to be rent-exempt")]\n    AccountNotRentExempt,\n    #[error("Unsupported sysvar")]\n    UnsupportedSysvar,\n    #[error("Provided owner is not allowed")]\n    IllegalOwner,\n    #[error("Accounts data allocations exceeded the maximum allowed per transaction")]\n    MaxAccountsDataAllocationsExceeded,\n    #[error("Account data reallocation was invalid")]\n    InvalidRealloc,\n    #[error("Instruction trace length exceeded the maximum allowed per transaction")]\n    MaxInstructionTraceLengthExceeded,\n    #[error("Builtin programs must consume compute units")]\n    BuiltinProgramsMustConsumeComputeUnits,\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u56e0\u6b64\u6211\u4eec\u7684 process \u51fd\u6570\u91cc\u9762\u5fc5\u987b\u8981\u8fd4\u56de\u8fd9\u91cc\u7684\u4e00\u4e2a\u503c\u679a\u4e3e\u503c\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u4e0a\u9762\u7684\u9519\u8bef\u679a\u4e3e\uff0c\u57fa\u672c\u610f\u4e49\u8fd8\u662f\u6bd4\u8f83\u660e\u786e\u7684\u3002\u6bd4\u5982\u53c2\u6570\u4e0d\u5bf9\uff0cGas \u4e0d\u591f\u3002\u76f8\u5f53\u4e8e\u7cfb\u7edf\u5df2\u7ecf\u628a\u9519\u8bef\u8fdb\u884c\u4e86\u5206\u7c7b\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u4f46\u662f\u6211\u4eec\u5408\u7ea6\u4e2d\u7684\u9519\u8bef\u5176\u5b9e\u662f\u6bcf\u4e2a\u903b\u8f91\u4e0d\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u8981\u5982\u4f55\u53bb\u5b9a\u4e49\u4ed6\u5462\uff1f"}),"\n",(0,o.jsx)(n.p,{children:"\u8fd9\u91cc\u4e0a\u9762\u7684\u5206\u7c7b\u4e2d\u6709\u4e00\u7c7b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:"Custom(u32)\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u8fd9\u4e2a\u5c31\u662f\u4e13\u95e8\u7ed9\u5e94\u7528\u5408\u7ea6\u5b9a\u4e49\u5176\u9519\u8bef\u7528\u7684\uff0c\u6bcf\u4e2a\u9519\u8bef\u7528\u4e00\u4e2a u32 \u6765\u8868\u793a"}),"\n",(0,o.jsx)(n.h2,{id:"2\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49",children:"2\u3001\u5408\u7ea6\u9519\u8bef\u5b9a\u4e49"}),"\n",(0,o.jsx)(n.p,{children:"\u65e2\u7136\u662f\u7528 u32 \u7c7b\u533a\u522b\u5408\u7ea6\u9519\u8bef\uff0c\u81ea\u7136\u6211\u4eec\u60f3\u5230\u4e86 Rust \u91cc\u9762\u7684 enum \u6765\u5b9a\u4e49\u9519\u8bef\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'#[derive(Clone, Debug, Eq, Error, FromPrimitive, PartialEq)]\npub enum HelloWorldError {\n    #[error("Not owned by HelloWolrd Program")]\n    NotOwnedByHelloWrold,\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u4f46\u662f\u8fd9\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u679a\u4e3e\uff0c\u8981\u5982\u4f55\u8ba9\u4ed6\u53d8\u6210\u4e0a\u9762\u7684 Custom(u32) \u5462\uff1f\u56e0\u6b64\u9700\u8981\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:"impl From<HelloWorldError> for ProgramError {\n    fn from(e: HelloWorldError) -> Self {\n        ProgramError::Custom(e as u32)\n    }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u76f4\u63a5\u5c06\u679a\u4e3e\u7684\u503c\uff0c\u8f6c\u6362\u6210\u4e86 Custom \u91cc\u9762\u7684\u9519\u8bef\u7801\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u9519\u8bef\u7801\u6709\u4e86\uff0c\u4f46\u662f\u9519\u8bef\u7801\u5bf9\u5e94\u7684\u610f\u4e49\u662f\u4ec0\u4e48\u5462\uff1f"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'impl PrintProgramError for HelloWorldError {\n    fn print<E>(&self)\n    where\n        E: \'static + std::error::Error + DecodeError<E> + PrintProgramError + FromPrimitive,\n    {\n        match self {\n            HelloWorldError::NotOwnedByHelloWrold => msg!("Error: Greeted account does not have the correct program id!"),\n        }\n    }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u8fd9\u91cc\u901a\u8fc7 PrintProgramError trate \u7684\u5b9e\u73b0\uff0c\u6765\u5b9a\u4e49\u5176\u9519\u8bef\u6d88\u606f\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u8fd9\u6837\u5728\u51fa\u9519\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u76f8\u5e94\u9519\u8bef\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'if greeting_account.owner != program_id {\n    msg!("Greeted account does not have the correct program id");\n    return Err(HelloWorldError::NotOwnedByHelloWrold.into());\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u901a\u8fc7 into \u76f4\u63a5\u8f6c\u6362\u3002"})]})}function u(r={}){const{wrapper:n}={...(0,a.a)(),...r.components};return n?(0,o.jsx)(n,{...r,children:(0,o.jsx)(d,{...r})}):d(r)}},7279:(r,n,e)=>{e.d(n,{Z:()=>l,a:()=>s});var o=e(959);const a={},t=o.createContext(a);function s(r){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof r?r(n):{...n,...r}}),[n,r])}function l(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(a):r.components||a:s(r.components),o.createElement(t.Provider,{value:n},r.children)}}}]);