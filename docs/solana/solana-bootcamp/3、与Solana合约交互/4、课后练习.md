---
id: solana-contract-execise
title: 4ã€è¯¾åç»ƒä¹ 
---

```mdx-code-block
import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';
import BrowserWindow from '@site/src/components/BrowserWindow';
```

è¯¾åç»ƒä¹ 
å®ç°ä¸€ä¸ª DApp é¡µé¢ï¼Œå®ç°ä»£å¸åˆ›å»ºï¼Œå¹¶æŒ‰ç™½åå•å‘é€ç©ºæŠ•

æç¤ºï¼š

-   é€šè¿‡ä¸ Token åˆçº¦äº¤äº’ï¼Œåˆ›å»ºä»£å¸
-   é€šè¿‡ä¸ Token åˆçº¦äº¤äº’ï¼Œç»™ç™½åå•ä¸­çš„åœ°å€ï¼Œå‘é€ SPL Token ä»£å¸
-   å»ºè®®ä½¿ç”¨ SPL-Token æä¾›çš„åº“æ¥æ„å»º instruction

## 1ã€Demo

[ç½‘å€æ¼”ç¤º](http://tool.iroyswift.com/#/tutorial/baseTokenAirdrop)

-   é¡µé¢æˆªå›¾

```mdx-code-block
<BrowserWindow minHeight={240} >
    <ThemedImage
    alt="Docusaurus themed image"
    sources={{
        light: useBaseUrl('/img/solana/mint_token_transfer.png'),
        dark: useBaseUrl('/img/solana/mint_token_transfer.png'),
    }}
    />
</BrowserWindow>
```

[ç½‘å€æ¼”ç¤º](http://tool.iroyswift.com/#/tutorial/mintToken)

-   é¡µé¢æˆªå›¾

```mdx-code-block
<BrowserWindow minHeight={240} >
    <ThemedImage
    alt="Docusaurus themed image"
    sources={{
        light: useBaseUrl('/img/solana/mint_token_transfer_2.png'),
        dark: useBaseUrl('/img/solana/mint_token_transfer_2.png'),
    }}
    />
</BrowserWindow>
```

## 2ã€ ä¸ä½¿ç”¨é’±åŒ…åˆ›å»º Token

Create Token PublicKey: [7yeP7VUDJ16zJH7DYwmeAAisHB3DHHPAUuHQzCEKZzhj](https://explorer.solana.com/address/7yeP7VUDJ16zJH7DYwmeAAisHB3DHHPAUuHQzCEKZzhj?cluster=devnet)

Mint Token Transaction: [5Zpq9tR3X2JE6NwrP9pJ3HEKHWt6eykfT8JJoQusovzfzxPp2fZ6YJCBnNUdvGGieCVhRPJAc885w9cYePQbxM62](https://explorer.solana.com/tx/5Zpq9tR3X2JE6NwrP9pJ3HEKHWt6eykfT8JJoQusovzfzxPp2fZ6YJCBnNUdvGGieCVhRPJAc885w9cYePQbxM62?cluster=devnet)

### åˆ›å»º token ä¸é“¸å¸

:::tip

createMint ä¸ createAssociatedTokenAccount åŒæ—¶ä½¿ç”¨æ—¶æ³¨æ„ï¼š

    - Connection è¦ç”¨ **confirmed** ,
    - ä¸ç„¶ä¼šå¯¼è‡´è°ƒç”¨createAssociatedTokenAccountæŠ¥é”™ï¼Œ
    - å› ä¸ºcreateMintè¿˜æ²¡æœ‰ç¡®è®¤æ— æ³•åˆ›å»ºATAè´¦å·

```typescript
// Step 1 è¿æ¥åˆ°Solanaç½‘ç»œ devnet
const devnet = clusterApiUrl("devnet");
const connection = new Connection(devnet, "confirmed");
```

:::

```typescript title="solana_tools/client/src/pages/Tutorial/BaseTokenAirdrop/MintToken.tsx"
// åˆ›å»ºTokenå’ŒATA
const createToken = async () => {
    setLoading(true);
    // åˆ›å»ºä¸€ä¸ªæ–°çš„ mint ï¼ˆé“¸å¸ï¼‰
    const mint: PublicKey = await createMint(
        connection,
        signer,
        signer.publicKey,
        signer.publicKey,
        9
    );
    console.log(`   âœ… - Token mint address: ${mint.toBase58()}`);

    // åˆ›å»ºAYTAè´¦å·
    const ata = await createAssociatedTokenAccount(
        connection,
        signer,
        mint,
        signer.publicKey
    );
    console.log(`   âœ… - Token ATA address: ${ata.toBase58()}`);

    setLoading(false);

    enqueueSnackbar("ğŸ‰ Mint Token succesfully!", {
        variant: "success",
    });
};

// Mint Token
const handleMintToken = async (
    mint: PublicKey,
    ata: PublicKey,
    mintNumber: number
) => {
    setLoading(true);

    const Signature = await mintTo(
        connection,
        signer,
        mint,
        ata,
        signer,
        mintNumber * LAMPORTS_PER_SOL
    );

    setLoading(false);

    console.log(
        `   âœ… - Mint ${mintNumber} Token To ${ata.toBase58()} transaction:${Signature}`
    );
    enqueueSnackbar(`ğŸ‰ Mint ${mintNumber} Token succesfully!`, {
        variant: "success",
    });
};
```

### æŸ¥è¯¢æ‹¥æœ‰é“¸å¸æƒé™çš„ token

:::tip

æŸ¥è¯¢åçš„åˆ—è¡¨è¦ç­›é€‰å‡ºæ‹¥æœ‰é“¸å¸æƒçš„ token

```typescript
// ç­›é€‰æ‹¥æœ‰é“¸å¸æƒé™çš„token
const mintInfo = await getMint(connection, accountInfo.mint);
```

:::

```typescript
// æŸ¥è¯¢Tokenåˆ—è¡¨
const queryTokenList = async () => {
    setLoading(true);
    let arr: itokenItem[] = [];
    setTokenList([]);
    const result: any = await connection.getTokenAccountsByOwner(
        signer.publicKey,
        {
            programId: TOKEN_PROGRAM_ID,
        }
    );
    result.value.forEach(async item => {
        // å¤„ç†Unit8Arrayæ•°æ®
        const dataUnit8Array = item.account.data;
        // å°†Unit8Arrayè½¬æ¢ä¸ºJSON
        const accountInfo = AccountLayout.decode(dataUnit8Array);

        // ç­›é€‰æ‹¥æœ‰é“¸å¸æƒé™çš„token
        const mintInfo = await getMint(connection, accountInfo.mint);
        if (
            mintInfo.mintAuthority?.toBase58() === signer.publicKey.toBase58()
        ) {
            arr.push(
                createData(
                    accountInfo.mint,
                    item.pubkey,
                    Number(accountInfo.amount / BigInt(LAMPORTS_PER_SOL)),
                    1
                )
            );
        }
    });
    setTimeout(() => {
        setTokenList(arr);
        setLoading(false);
    }, 10000);
};
```

## 3.é€šè¿‡é’±åŒ…åˆ›å»º token

### åˆ›å»º token

```typescript title="solana_tools/client/src/utils/solana/mintToken.ts"
/**
 * åˆ›å»ºToken
 * @param connection       Connection to use from useWallet
 * @param pubkey           Payer of the transaction and initialization fees
 * @param sendTransaction  from useWallet
 * @param keypair          Optional keypair, defaulting to a new random one
 * @returns
 */
const createToken = async (
    connection: Connection,
    pubkey: PublicKey,
    sendTransaction: WalletAdapterProps["sendTransaction"]
): Promise<PublicKey> => {
    const mintKeypair = Keypair.generate();

    // * Step 1 - create an array with your desires `instructions`

    const lamports = await getMinimumBalanceForRentExemptMint(connection);
    const instructions = [
        SystemProgram.createAccount({
            fromPubkey: pubkey,
            newAccountPubkey: mintKeypair.publicKey,
            space: MINT_SIZE,
            lamports,
            programId: TOKEN_PROGRAM_ID,
        }),
        createInitializeMint2Instruction(
            mintKeypair.publicKey,
            9,
            pubkey,
            pubkey
        ),
    ];
    console.log(
        "   âœ… - Step 1 - create an array with your desires `instructions`"
    );

    // * Step 2 - Generate a transaction and send it to the network
    const txid = await createAndSendV0TxByWallet(
        pubkey,
        connection,
        sendTransaction,
        instructions,
        [mintKeypair]
    );
    console.log(
        "   âœ… - Step 2 - Generate a transaction and send it to the network"
    );

    enqueueSnackbar("ğŸ‰ Transaction succesfully confirmed!");
    enqueueSnackbar(`https://explorer.solana.com/tx/${txid}?cluster=devnet`);
    return mintKeypair.publicKey;
};
```

```typescript title="solana_tools/client/src/pages/Tutorial/BaseTokenAirdrop/MintToken.tsx"
import { createToken, mintToken } from "@/utils/solana";

// åˆ›å»ºTokenå’ŒATA
const onCreateToken = async () => {
    if (!pubkey) {
        AlertTip();
        return;
    }
    setLoading(true);
    // åˆ›å»ºä¸€ä¸ªæ–°çš„ mint ï¼ˆé“¸å¸ï¼‰
    const mint: PublicKey = await createToken(
        connection,
        pubkey,
        sendTransaction
    );
    setMint(mint);
    console.log(`   âœ… - Token mint address: ${mint.toBase58()}`);

    setLoading(false);
    enqueueSnackbar("ğŸ‰ Mint Token succesfully!", {
        variant: "success",
    });
};
```

## 4.å‘é€ Token

### åˆ›å»ºæŒ‡ä»¤

ç»™é’±åŒ…åœ°å€ï¼šGir7LUMrsXHv5gGctKNp6th2Pj7j9qmYR1LSrsHS6Yaj å‘é€ 1 ä¸ª tokenï¼š7yeP7VUDJ16zJH7DYwmeAAisHB3DHHPAUuHQzCEKZzhj

Transfer ç»“æœï¼š[4BYEaSzTTtFgHwysiiNDnX3UePZLDNeoNYVB3i7nA3PzcoFhy1e3bz1CrRTxwjpVoc12piT1bmf45jkSEJddkHaN](https://explorer.solana.com/tx/4BYEaSzTTtFgHwysiiNDnX3UePZLDNeoNYVB3i7nA3PzcoFhy1e3bz1CrRTxwjpVoc12piT1bmf45jkSEJddkHaN?cluster=devnet)

```typescript
// * Step 2 - create an array with your desires `instructions`
const txInstructions = [
    createTransferInstruction(
        ataPubkey.address,
        toAtaPubkey.address,
        signer.publicKey,
        1 * LAMPORTS_PER_SOL
    ),
];
console.log(
    "   âœ… - Step 2 - create an array with your desires `instructions`"
);

// * Step 3 - Generate a transaction and send it to the network
const txid = await createAndSendV0Tx(signer, connection, txInstructions);
console.log(
    "   âœ… - Step 3 - Generate a transaction and send it to the network"
);
```

### åˆ›å»ºå¹¶å‘é€ç‰ˆæœ¬åŒ–äº¤æ˜“

```typescript
/**
 * åˆ›å»ºå¹¶å‘é€ç‰ˆæœ¬åŒ–äº¤æ˜“
 * @param signer                 Payer of the transaction and initialization fees
 * @param connection             Connection to use
 * @param txInstructions         Transaction Instruction Array
 * @param lookupTableAccount     Address Lookup Table Account
 * @returns                      Promise Transaction signature as base-58 encoded string
 */
async function createAndSendV0Tx(
    signer: Signer,
    connection: Connection,
    txInstructions: TransactionInstruction[],
    lookupTableAccount?: AddressLookupTableAccount
): Promise<TransactionSignature> {
    // * Step 1 - Fetch Latest Blockhash
    // let latestBlockhash = await connection.getLatestBlockhash("finalized");
    const {
        context: { slot: minContextSlot },
        value: { blockhash, lastValidBlockHeight },
    } = await connection.getLatestBlockhashAndContext();
    console.log(
        "   âœ… - 1. Fetched latest blockhash. Last valid height:",
        lastValidBlockHeight
    );

    // * Step 2 - Generate Transaction Message
    let messageV0;
    if (lookupTableAccount) {
        messageV0 = new TransactionMessage({
            payerKey: signer.publicKey,
            recentBlockhash: blockhash,
            instructions: txInstructions,
        }).compileToV0Message([lookupTableAccount]);
    } else {
        messageV0 = new TransactionMessage({
            payerKey: signer.publicKey,
            recentBlockhash: blockhash,
            instructions: txInstructions,
        }).compileToV0Message();
    }
    console.log("   âœ… - 2. Compiled transaction message");
    const transaction = new VersionedTransaction(messageV0);

    // * Step 3 - Sign your transaction with the required `Signers`
    transaction.sign([signer]);
    console.log("   âœ… - 3. Transaction Signed");

    // * Step 4 - Send our v0 transaction to the cluster
    const txid = await connection.sendTransaction(transaction, {
        maxRetries: 5,
        minContextSlot,
    });
    console.log("   âœ… - 4. Transaction sent to network");

    // * Step 5 - Confirm Transaction
    const confirmation = await connection.confirmTransaction({
        signature: txid,
        blockhash: blockhash,
        lastValidBlockHeight: lastValidBlockHeight,
    });
    if (confirmation.value.err) {
        throw new Error("   âŒ - 5. Transaction not confirmed.");
    }

    console.log(
        "   ğŸ‰ - 5. Transaction succesfully confirmed!",
        `https://explorer.solana.com/tx/${txid}?cluster=devnet`
    );
    return txid;
}
```

## 5ã€é€šè¿‡é’±åŒ…å‘é€ Token

:::tip

createTransferInstruction ä¸ createMintToInstruction éƒ½å¯ä»¥å‘é€ä»£å¸

:::

```typescript title="solana_tools/client/src/utils/solana/mintToken.ts"
/**
 * Mint Token
 * @param connection      Connection to use from useWallet
 * @param pubkey          Payer of the transaction and initialization fees
 * @param mint            Mint Address
 * @param toPubkey        Address to mint to
 * @param amount          Amount to mint
 * @param sendTransaction from useWallet
 * @returns
 */
const mintToken = async (
    connection: Connection,
    pubkey: PublicKey,
    mint: PublicKey,
    toPubkey: PublicKey,
    amount: number,
    sendTransaction: WalletAdapterProps["sendTransaction"]
): Promise<PublicKey> => {
    // * Step 1 - create an array with your desires `instructions`
    // è·å–ATAè´¦å·
    const ataAccount = getAssociatedTokenAddressSync(mint, toPubkey);
    console.log(
        "ğŸš€ ~ file: mintToken.ts:94 ~ toPubkey:",
        toPubkey.toBase58(),
        ataAccount.toBase58()
    );

    let instructions: TransactionInstruction[] = [];
    try {
        await getAccount(connection, ataAccount);
    } catch (error) {
        // åˆ›å»ºAYTA
        instructions.push(
            createAssociatedTokenAccountInstruction(
                pubkey,
                ataAccount,
                toPubkey,
                mint
            )
        );
    }
    instructions.push(
        // mint token
        createMintToInstruction(mint, ataAccount, pubkey, amount)
    );

    // * Step 2 - Generate a transaction and send it to the network
    const txid = await createAndSendV0TxByWallet(
        pubkey,
        connection,
        sendTransaction,
        instructions
    );
    console.log(
        "   âœ… - Step 2 - Generate a transaction and send it to the network"
    );

    enqueueSnackbar("ğŸ‰ Transaction succesfully confirmed!");
    enqueueSnackbar(`https://explorer.solana.com/tx/${txid}?cluster=devnet`);
    return ataAccount;
};
```

```typescript
const onMint = async () => {
    if (!pubkey || !mint || !toPubkey) {
        enqueueSnackbar(`æ²¡æœ‰è·å–åˆ°pubkeyã€mintã€toPubkeyè´¦å·ï¼`, {
            variant: "warning",
        });
        return;
    }
    const ata = await mintToken(
        connection,
        pubkey,
        mint,
        toPubkey,
        toCount,
        sendTransaction
    );
    setAtaAccount(ata);
};
```
